bootdelay=0
ipaddr=10.11.12.13
serverip=10.11.12.1
bootenv=uEnv.txt
fdt_high=0x20000000
kernel_image=uImage
old_bitstream_image=parallella.bit.bin
old_devicetree_image=devicetree.dtb
loadbootenv_addr=0x2000000

slowblink=led 0 toggle && sleep 1 && led 0 toggle && sleep 1 || true

loadbootenv=load mmc 0 ${loadbootenv_addr} ${bootenv}

importbootenv=echo Importing environment from SD ...;  \
	env import -t ${loadbootenv_addr} $filesize

importbootenvtftp=echo Importing environment from TFTP ...; \
	env import -t ${loadbootenv_addr} $filesize

preboot=\
	if mmcinfo; then \
		led 0 on; \
		run slowblink; \
		env set modeboot sdboot_old; \
		run loadbootenv && \
		run importbootenv && \
		env set modeboot sdboot; \
	else \
		led 0 off; \
		env set modeboot tftpboot; \
	fi;

sdboot_old=\
	echo Legacy boot from SD card...; \
	load mmc 0 0x4000000 ${old_bitstream_image} && \
	fpga load 0 0x4000000 $filesize && \
	run slowblink; \
	load mmc 0 0x3000000 ${kernel_image} && \
	load mmc 0 0x2A00000 ${old_devicetree_image} && \
	run slowblink && \
	bootm 0x3000000 - 0x2A00000; \
	led 0 off

tftpboot=\
	while true; do \
		echo TFTPing second stage boot script... && \
		tftpboot ${loadbootenv_addr} ${bootenv} && \
		run importbootenvtftp && \
		run tftpboot_stage2; \
	done

bootcmd=run $modeboot

# STDIO
baudrate=115200
stderr=serial
stdin=serial
stdout=serial
